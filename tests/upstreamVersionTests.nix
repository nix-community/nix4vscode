{ lib }:
let
  matchesVscodeVersion = import ../nix/matchesVscodeVersion.nix lib;
  assertIsValidVersion =
    vscodeVersion: versionSelector: expected:
    lib.nameValuePair "test ${vscodeVersion} matches ${versionSelector}" {
      inherit expected;
      expr = matchesVscodeVersion vscodeVersion versionSelector;
    };
in
# Just like upstream tests.
# See https://github.com/nix-community/nix4vscode/pull/310#discussion_r2191784306
builtins.listToAttrs [
  (assertIsValidVersion "0.10.0-dev" "x.x.x" true)
  (assertIsValidVersion "0.10.0-dev" "0.x.x" true)
  (assertIsValidVersion "0.10.0-dev" "0.10.0" true)
  (assertIsValidVersion "0.10.0-dev" "0.10.2" false)
  (assertIsValidVersion "0.10.0-dev" "^0.10.2" false)
  (assertIsValidVersion "0.10.0-dev" "0.10.x" true)
  (assertIsValidVersion "0.10.0-dev" "^0.10.0" true)
  (assertIsValidVersion "0.10.0-dev" "*" true)
  (assertIsValidVersion "0.10.0-dev" ">=0.0.1" true)
  (assertIsValidVersion "0.10.0-dev" ">=0.0.10" true)
  (assertIsValidVersion "0.10.0-dev" ">=0.10.0" true)
  (assertIsValidVersion "0.10.0-dev" ">=0.10.1" false)
  (assertIsValidVersion "0.10.0-dev" ">=1.0.0" false)

  (assertIsValidVersion "0.10.0" "x.x.x" true)
  (assertIsValidVersion "0.10.0" "0.x.x" true)
  (assertIsValidVersion "0.10.0" "0.10.0" true)
  (assertIsValidVersion "0.10.0" "0.10.2" false)
  (assertIsValidVersion "0.10.0" "^0.10.2" false)
  (assertIsValidVersion "0.10.0" "0.10.x" true)
  (assertIsValidVersion "0.10.0" "^0.10.0" true)
  (assertIsValidVersion "0.10.0" "*" true)

  (assertIsValidVersion "0.10.1" "x.x.x" true)
  (assertIsValidVersion "0.10.1" "0.x.x" true)
  (assertIsValidVersion "0.10.1" "0.10.0" false)
  (assertIsValidVersion "0.10.1" "0.10.2" false)
  (assertIsValidVersion "0.10.1" "^0.10.2" false)
  (assertIsValidVersion "0.10.1" "0.10.x" true)
  (assertIsValidVersion "0.10.1" "^0.10.0" true)
  (assertIsValidVersion "0.10.1" "*" true)

  (assertIsValidVersion "0.10.100" "x.x.x" true)
  (assertIsValidVersion "0.10.100" "0.x.x" true)
  (assertIsValidVersion "0.10.100" "0.10.0" false)
  (assertIsValidVersion "0.10.100" "0.10.2" false)
  (assertIsValidVersion "0.10.100" "^0.10.2" true)
  (assertIsValidVersion "0.10.100" "0.10.x" true)
  (assertIsValidVersion "0.10.100" "^0.10.0" true)
  (assertIsValidVersion "0.10.100" "*" true)

  (assertIsValidVersion "0.11.0" "x.x.x" true)
  (assertIsValidVersion "0.11.0" "0.x.x" true)
  (assertIsValidVersion "0.11.0" "0.10.0" false)
  (assertIsValidVersion "0.11.0" "0.10.2" false)
  (assertIsValidVersion "0.11.0" "^0.10.2" false)
  (assertIsValidVersion "0.11.0" "0.10.x" false)
  (assertIsValidVersion "0.11.0" "^0.10.0" false)
  (assertIsValidVersion "0.11.0" "*" true)

  # Anything < 1.0.0 is compatible

  (assertIsValidVersion "1.0.0" "x.x.x" true)
  (assertIsValidVersion "1.0.0" "0.x.x" true)
  (assertIsValidVersion "1.0.0" "0.10.0" false)
  (assertIsValidVersion "1.0.0" "0.10.2" false)
  (assertIsValidVersion "1.0.0" "^0.10.2" true)
  (assertIsValidVersion "1.0.0" "0.10.x" true)
  (assertIsValidVersion "1.0.0" "^0.10.0" true)
  (assertIsValidVersion "1.0.0" "1.0.0" true)
  (assertIsValidVersion "1.0.0" "^1.0.0" true)
  (assertIsValidVersion "1.0.0" "^2.0.0" false)
  (assertIsValidVersion "1.0.0" "*" true)
  (assertIsValidVersion "1.0.0" ">=0.0.1" true)
  (assertIsValidVersion "1.0.0" ">=0.0.10" true)
  (assertIsValidVersion "1.0.0" ">=0.10.0" true)
  (assertIsValidVersion "1.0.0" ">=0.10.1" true)
  (assertIsValidVersion "1.0.0" ">=1.0.0" true)
  (assertIsValidVersion "1.0.0" ">=1.1.0" false)
  (assertIsValidVersion "1.0.0" ">=1.0.1" false)
  (assertIsValidVersion "1.0.0" ">=2.0.0" false)

  (assertIsValidVersion "1.0.100" "x.x.x" true)
  (assertIsValidVersion "1.0.100" "0.x.x" true)
  (assertIsValidVersion "1.0.100" "0.10.0" false)
  (assertIsValidVersion "1.0.100" "0.10.2" false)
  (assertIsValidVersion "1.0.100" "^0.10.2" true)
  (assertIsValidVersion "1.0.100" "0.10.x" true)
  (assertIsValidVersion "1.0.100" "^0.10.0" true)
  (assertIsValidVersion "1.0.100" "1.0.0" false)
  (assertIsValidVersion "1.0.100" "^1.0.0" true)
  (assertIsValidVersion "1.0.100" "^1.0.1" true)
  (assertIsValidVersion "1.0.100" "^2.0.0" false)
  (assertIsValidVersion "1.0.100" "*" true)

  (assertIsValidVersion "1.100.0" "x.x.x" true)
  (assertIsValidVersion "1.100.0" "0.x.x" true)
  (assertIsValidVersion "1.100.0" "0.10.0" false)
  (assertIsValidVersion "1.100.0" "0.10.2" false)
  (assertIsValidVersion "1.100.0" "^0.10.2" true)
  (assertIsValidVersion "1.100.0" "0.10.x" true)
  (assertIsValidVersion "1.100.0" "^0.10.0" true)
  (assertIsValidVersion "1.100.0" "1.0.0" false)
  (assertIsValidVersion "1.100.0" "^1.0.0" true)
  (assertIsValidVersion "1.100.0" "^1.1.0" true)
  (assertIsValidVersion "1.100.0" "^1.100.0" true)
  (assertIsValidVersion "1.100.0" "^2.0.0" false)
  (assertIsValidVersion "1.100.0" "*" true)
  (assertIsValidVersion "1.100.0" ">=1.99.0" true)
  (assertIsValidVersion "1.100.0" ">=1.100.0" true)
  (assertIsValidVersion "1.100.0" ">=1.101.0" false)

  (assertIsValidVersion "2.0.0" "x.x.x" true)
  (assertIsValidVersion "2.0.0" "0.x.x" false)
  (assertIsValidVersion "2.0.0" "0.10.0" false)
  (assertIsValidVersion "2.0.0" "0.10.2" false)
  (assertIsValidVersion "2.0.0" "^0.10.2" false)
  (assertIsValidVersion "2.0.0" "0.10.x" false)
  (assertIsValidVersion "2.0.0" "^0.10.0" false)
  (assertIsValidVersion "2.0.0" "1.0.0" false)
  (assertIsValidVersion "2.0.0" "^1.0.0" false)
  (assertIsValidVersion "2.0.0" "^1.1.0" false)
  (assertIsValidVersion "2.0.0" "^1.100.0" false)
  (assertIsValidVersion "2.0.0" "^2.0.0" true)
  (assertIsValidVersion "2.0.0" "*" true)
]
